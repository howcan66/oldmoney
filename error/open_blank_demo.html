<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Blank Demo</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .header-nav-extended {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nav-index {
            font-weight: 600;
            color: #283046;
            font-size: 14px;
            user-select: none;
            min-width: 60px;
            text-align: center;
        }
        
        .nav-arrow-btn {
            padding: 6px 10px;
            background-color: #283046;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            min-width: 40px;
            text-align: center;
        }
        
        .nav-arrow-btn:hover:not(:disabled) {
            background-color: #1e2333;
        }
        
        .nav-arrow-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .content-frame-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            min-height: 400px;
        }
        
        .content-frame-container iframe {
            width: 100%;
            height: 600px;
            border: none;
            display: block;
        }

        .embedded-note {
            padding: 20px;
            background-color: #F5F5FA;
            border: 1px solid #283046;
            border-radius: 4px;
            text-align: left;
            font-weight: 600;
            color: #283046;
        }
        
        @media (max-width: 768px) {
            .content-frame-container iframe {
                height: 400px;
            }
            
            .header-nav-extended {
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="title">Open Blank Demo</div>
        <div class="nav-buttons">
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="sv" 
                        onclick="switchLanguage('sv')" 
                        title="Byt till Svenska" 
                        aria-pressed="true">SV</button>
                <button class="lang-btn" data-lang="en" 
                        onclick="switchLanguage('en')" 
                        title="Switch to English" 
                        aria-pressed="false">EN</button>
            </div>
            <div class="header-nav-extended">
                <button class="nav-arrow-btn" id="prevBtn" onclick="previousLink()" 
                        title="Go to previous link" aria-label="Previous link">«</button>
                <span class="nav-index" aria-live="polite">
                    <span id="currentIndex">0</span> of <span id="totalCount">0</span>
                </span>
                <button class="nav-arrow-btn" id="nextBtn" onclick="nextLink()" 
                        title="Go to next link" aria-label="Next link">»</button>
            </div>
            <button class="refresh-btn" onclick="refreshPage()" 
                    title="Refresh page">Refresh</button>
            <button class="close-btn" onclick="closePage()" 
                    title="Close window">Close</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="content">
        <div class="content-frame-container">
            <iframe id="contentFrame" 
                    sandbox="allow-same-origin" 
                    referrerpolicy="no-referrer"
                    title="Content Frame">
            </iframe>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <span>&copy; CoolPortals | 
              <span id="footer-filename">open_blank_demo.html</span> | 
              <span id="footer-timestamp"></span></span>
    </footer>

    <script src="js/app.js"></script>
    <script>
        // Content sources: local pages only
        const contentSources = [
            { label: 'Open Blank Demo', url: 'open_blank_demo.html', local: true },
            { label: 'Home', url: 'index.html', local: true },
            { label: 'Interest Calculator', url: 'interestoninterest.html', local: true },
            { label: 'Open Blank', url: 'open_blank.html', local: true }
        ];
        
        let currentIndex = 0;
        let fallbackTimer = null;
        const supportsSrcdoc = 'srcdoc' in document.createElement('iframe');
        const isEmbedded = window.self !== window.top;
        
        /**
         * Initialize on page load
         */
        document.addEventListener('DOMContentLoaded', function() {
            if (isEmbedded) {
                const container = document.querySelector('.content-frame-container');
                if (container) {
                    container.innerHTML = '<div class="embedded-note">Open Blank Demo (embedded view)</div>';
                }
                document.getElementById('footer-timestamp').textContent = generateTimestamp();
                return;
            }
            const totalCount = document.getElementById('totalCount');
            if (totalCount) {
                totalCount.textContent = contentSources.length;
            }
            updateContentFrame();
            document.getElementById('footer-timestamp').textContent = generateTimestamp();
        });
        
        /**
         * Go to previous link
         */
        function previousLink() {
            if (currentIndex > 0) {
                currentIndex--;
                updateContentFrame();
            }
        }
        
        /**
         * Go to next link
         */
        function nextLink() {
            if (currentIndex < contentSources.length - 1) {
                currentIndex++;
                updateContentFrame();
            }
        }
        
        /**
         * Update iframe content and display
         */
        function updateContentFrame() {
            const contentFrame = document.getElementById('contentFrame');
            const indexDisplay = document.getElementById('currentIndex');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            // Update index display
            indexDisplay.textContent = currentIndex + 1;

            // Update button states
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === contentSources.length - 1;

            // Load content with fallback chain A -> B -> C
            loadContentWithFallback(contentSources[currentIndex]);
        }

        function loadContentWithFallback(item) {
            const contentFrame = document.getElementById('contentFrame');

            clearTimeout(fallbackTimer);
            contentFrame.removeAttribute('srcdoc');

            // A: Try to load the linked content directly
            contentFrame.onload = function() {
                clearTimeout(fallbackTimer);
            };

            contentFrame.onerror = function() {
                clearTimeout(fallbackTimer);
                fallbackToLocal(item);
            };

            contentFrame.src = item.url;

            // If load seems blocked, fallback after timeout
            fallbackTimer = setTimeout(function() {
                fallbackToLocal(item);
            }, 2500);
        }

        function fallbackToLocal(item) {
            const contentFrame = document.getElementById('contentFrame');

            // B: Show local content without browser UI using srcdoc
            if (supportsSrcdoc) {
                const localHtml = buildLocalHtml(item.label);
                contentFrame.removeAttribute('src');
                contentFrame.srcdoc = localHtml;
                return;
            }

            // C: Fallback to local file if srcdoc not supported
            contentFrame.src = 'open_blank_local.html?title=' + encodeURIComponent(item.label);
        }

        function buildLocalHtml(title) {
            return `<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${title}</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; text-align: left; }
    h2 { color: #283046; margin-top: 0; }
    p { color: #333; }
  </style>
</head>
<body>
  <h2>${title}</h2>
  <p>Local view displayed without browser UI.</p>
</body>
</html>`;
        }
    </script>
</body>
</html>
